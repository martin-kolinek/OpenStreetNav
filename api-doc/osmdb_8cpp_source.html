<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>

<title>/home/martin/workspace/OpenStreetNav/src/test/osmdb.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<!-- Generated by Doxygen 1.7.5.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">/home/martin/workspace/OpenStreetNav/src/test/osmdb.cpp</div>  </div>
</div>
<div class="contents">
<a href="osmdb_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * osmdb.cpp</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> *  Created on: Nov 6, 2011</span>
<a name="l00005"></a>00005 <span class="comment"> *      Author: martin</span>
<a name="l00006"></a>00006 <span class="comment"> */</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;boost/test/unit_test.hpp&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;boost/filesystem.hpp&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;boost/property_tree/xml_parser.hpp&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;../osmdb/osmdb.h&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;../sqllib/sqllib.h&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;test_config.h&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00015"></a>00015 
<a name="l00016"></a><a class="code" href="classOsmDBFixture.html">00016</a> <span class="keyword">class </span><a class="code" href="classOsmDBFixture.html">OsmDBFixture</a>
<a name="l00017"></a>00017 {
<a name="l00018"></a>00018 <span class="keyword">public</span>:
<a name="l00019"></a><a class="code" href="classOsmDBFixture.html#a3bf4ae21a9b77ecf893fca5a0d196553">00019</a>     <a class="code" href="classOsmDBFixture.html#a3bf4ae21a9b77ecf893fca5a0d196553">OsmDBFixture</a>():
<a name="l00020"></a>00020         <a class="code" href="classOsmDBFixture.html#a3256d2f0edb3695ebbf62db62e24c7f7">pdb</a>(<span class="stringliteral">&quot;&quot;</span>)
<a name="l00021"></a>00021     {
<a name="l00022"></a>00022 
<a name="l00023"></a>00023         <a class="code" href="namespacepsql.html#ac4129ca3777f1406383d1d73ab3476bb" title="Utility function which constructs a Statement with no arguments and executes it.">psql::execute_sql</a>(<a class="code" href="classOsmDBFixture.html#a3256d2f0edb3695ebbf62db62e24c7f7">pdb</a>, <span class="stringliteral">&quot;CREATE SCHEMA testing&quot;</span>);
<a name="l00024"></a>00024         <a class="code" href="namespacepsql.html#ac4129ca3777f1406383d1d73ab3476bb" title="Utility function which constructs a Statement with no arguments and executes it.">psql::execute_sql</a>(<a class="code" href="classOsmDBFixture.html#a3256d2f0edb3695ebbf62db62e24c7f7">pdb</a>, <span class="stringliteral">&quot;SET search_path TO testing, public&quot;</span>);
<a name="l00025"></a>00025     }
<a name="l00026"></a><a class="code" href="classOsmDBFixture.html#a996ea8df368f083c6992c1bc2960275b">00026</a>     <a class="code" href="classOsmDBFixture.html#a996ea8df368f083c6992c1bc2960275b">~OsmDBFixture</a>()
<a name="l00027"></a>00027     {
<a name="l00028"></a>00028         <span class="keywordflow">if</span> (<a class="code" href="classOsmDBFixture.html#a3256d2f0edb3695ebbf62db62e24c7f7">pdb</a>.<a class="code" href="classpsql_1_1Database.html#a1a91024d21014e00cc9cc42e075406bf">in_transaction</a>() || <a class="code" href="classOsmDBFixture.html#a3256d2f0edb3695ebbf62db62e24c7f7">pdb</a>.<a class="code" href="classpsql_1_1Database.html#a6b749ddf36ec2596c11faa8d55d1926b">in_failed_transaction</a>())
<a name="l00029"></a>00029             <a class="code" href="classOsmDBFixture.html#a3256d2f0edb3695ebbf62db62e24c7f7">pdb</a>.<a class="code" href="classpsql_1_1Database.html#ab7d00a0069adf62594f46aa6a30bdc99" title="Rollbacks a transaction on this connection.">rollback_transaction</a>();
<a name="l00030"></a>00030         <a class="code" href="namespacepsql.html#ac4129ca3777f1406383d1d73ab3476bb" title="Utility function which constructs a Statement with no arguments and executes it.">psql::execute_sql</a>(<a class="code" href="classOsmDBFixture.html#a3256d2f0edb3695ebbf62db62e24c7f7">pdb</a>, <span class="stringliteral">&quot;DROP SCHEMA testing CASCADE&quot;</span>);
<a name="l00031"></a>00031     }
<a name="l00032"></a><a class="code" href="classOsmDBFixture.html#a3256d2f0edb3695ebbf62db62e24c7f7">00032</a>     <a class="code" href="classpsql_1_1Database.html" title="Represents a connection to PostgreSQL database.">psql::Database</a> <a class="code" href="classOsmDBFixture.html#a3256d2f0edb3695ebbf62db62e24c7f7">pdb</a>;
<a name="l00033"></a>00033 };
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 BOOST_FIXTURE_TEST_SUITE(OsmDBCreateTests, <a class="code" href="classOsmDBFixture.html">OsmDBFixture</a>)
<a name="l00036"></a>00036 
<a name="l00037"></a><a class="code" href="osmdb_8cpp.html#a504f79d7623f6b4064d243cc95297497">00037</a> <a class="code" href="osmdb_8cpp.html#a504f79d7623f6b4064d243cc95297497">BOOST_AUTO_TEST_CASE</a>(create)
<a name="l00038"></a>00038 {
<a name="l00039"></a>00039     <a class="code" href="classosmdb_1_1OsmDatabase.html" title="Class responsible for creating database schema.">osmdb::OsmDatabase</a> db(pdb);
<a name="l00040"></a>00040     db.<a class="code" href="classosmdb_1_1OsmDatabase.html#adc831649dec60db62f40da1c4e75f12b" title="Creates needed tables in the database.">create_tables</a>();
<a name="l00041"></a>00041 }
<a name="l00042"></a>00042 
<a name="l00043"></a><a class="code" href="osmdb_8cpp.html#aa5624fe99c67137ecb9461ecfa1c65ca">00043</a> <a class="code" href="osmdb_8cpp.html#a504f79d7623f6b4064d243cc95297497">BOOST_AUTO_TEST_CASE</a>(indexes)
<a name="l00044"></a>00044 {
<a name="l00045"></a>00045     <a class="code" href="classosmdb_1_1OsmDatabase.html" title="Class responsible for creating database schema.">osmdb::OsmDatabase</a> db(pdb);
<a name="l00046"></a>00046     db.<a class="code" href="classosmdb_1_1OsmDatabase.html#adc831649dec60db62f40da1c4e75f12b" title="Creates needed tables in the database.">create_tables</a>();
<a name="l00047"></a>00047     db.<a class="code" href="classosmdb_1_1OsmDatabase.html#aadc1ac7adc374532f0a66f6297e18e9e" title="Creates indexes and keys, this does not happen right away for optimization purposes.">create_indexes_and_keys</a>();
<a name="l00048"></a>00048     db.<a class="code" href="classosmdb_1_1OsmDatabase.html#a3b854045144f919f7f6de7f97480283c" title="Drops all indexes and keys.">drop_indexes_and_keys</a>();
<a name="l00049"></a>00049     db.<a class="code" href="classosmdb_1_1OsmDatabase.html#aadc1ac7adc374532f0a66f6297e18e9e" title="Creates indexes and keys, this does not happen right away for optimization purposes.">create_indexes_and_keys</a>();
<a name="l00050"></a>00050     db.<a class="code" href="classosmdb_1_1OsmDatabase.html#a3b854045144f919f7f6de7f97480283c" title="Drops all indexes and keys.">drop_indexes_and_keys</a>();
<a name="l00051"></a>00051 }
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="osmdb_8cpp.html#add649c691e700ac185dc55b0f4fb863c">00053</a> <a class="code" href="osmdb_8cpp.html#a504f79d7623f6b4064d243cc95297497">BOOST_AUTO_TEST_CASE</a>(insert)
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055 
<a name="l00056"></a>00056     <a class="code" href="classosmdb_1_1OsmDatabase.html" title="Class responsible for creating database schema.">osmdb::OsmDatabase</a> db(pdb);
<a name="l00057"></a>00057     db.<a class="code" href="classosmdb_1_1OsmDatabase.html#adc831649dec60db62f40da1c4e75f12b" title="Creates needed tables in the database.">create_tables</a>();
<a name="l00058"></a>00058     db.<a class="code" href="classosmdb_1_1OsmDatabase.html#aadc1ac7adc374532f0a66f6297e18e9e" title="Creates indexes and keys, this does not happen right away for optimization purposes.">create_indexes_and_keys</a>();
<a name="l00059"></a>00059     <a class="code" href="classosmdb_1_1ElementInsertion.html" title="Responsible for inserting osm elements into database.">osmdb::ElementInsertion</a> ins(db);
<a name="l00060"></a>00060     <a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a> n(123, 1, 2);
<a name="l00061"></a>00061     n.<a class="code" href="classosm_1_1Node.html#ae46c4674d161dab4d2c19fd667ebdd1f" title="Attributes of this Node.">tags</a>.insert(<a class="code" href="namespaceosm.html#ad6a83ea80b087de28d4bf3def9c2019a">osm::Tag</a>(<span class="stringliteral">&quot;nkey&quot;</span>, <span class="stringliteral">&quot;nval&quot;</span>));
<a name="l00062"></a>00062     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#a936b84b041dd4035a4601fa0e150f2c2" title="Inserts node into database.">insert_node</a>(n);
<a name="l00063"></a>00063     n.<a class="code" href="classosm_1_1Node.html#ae46c4674d161dab4d2c19fd667ebdd1f" title="Attributes of this Node.">tags</a>.clear();
<a name="l00064"></a>00064     n.<a class="code" href="classosm_1_1Node.html#ad185c39bb708987f65fedac24d5ffc7e">id</a> = 124;
<a name="l00065"></a>00065     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#a936b84b041dd4035a4601fa0e150f2c2" title="Inserts node into database.">insert_node</a>(n);
<a name="l00066"></a>00066     <a class="code" href="classosm_1_1Way.html" title="Represents a way in OpenStreetMap (a sequence of Nodes)">osm::Way</a> w(341);
<a name="l00067"></a>00067     w.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>.push_back(123);
<a name="l00068"></a>00068     w.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>.push_back(124);
<a name="l00069"></a>00069     w.<a class="code" href="classosm_1_1Way.html#a1fcc65bea2fe483ec5074d8527082853" title="Way attributes.">tags</a>.insert(<a class="code" href="namespaceosm.html#ad6a83ea80b087de28d4bf3def9c2019a">osm::Tag</a>(<span class="stringliteral">&quot;wkey&quot;</span>, <span class="stringliteral">&quot;wval&quot;</span>));
<a name="l00070"></a>00070     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#afbd9085b11e0fedfee39799ab12801ba" title="Inserts way into database.">insert_way</a>(w);
<a name="l00071"></a>00071     <a class="code" href="classosm_1_1Relation.html" title="Represents a relation in OpenStreetMap.">osm::Relation</a> r(432);
<a name="l00072"></a>00072     r.<a class="code" href="classosm_1_1Relation.html#a8d5ece4430a4613c3088a39cb54b2e46" title="Attributes of this relation.">tags</a>.insert(<a class="code" href="namespaceosm.html#ad6a83ea80b087de28d4bf3def9c2019a">osm::Tag</a>(<span class="stringliteral">&quot;rkey&quot;</span>, <span class="stringliteral">&quot;rval&quot;</span>));
<a name="l00073"></a>00073     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#a9ad89ebee202f58e1b5797b78412a346" title="Inserts relation into database.">insert_relation</a>(r);
<a name="l00074"></a>00074     r.<a class="code" href="classosm_1_1Relation.html#a8d5ece4430a4613c3088a39cb54b2e46" title="Attributes of this relation.">tags</a>.clear();
<a name="l00075"></a>00075     r.<a class="code" href="classosm_1_1Relation.html#a20b214bb2bfb793e75b1645cfc50d0c3">id</a> = 433;
<a name="l00076"></a>00076     r.<a class="code" href="classosm_1_1Relation.html#ab677d67ee44bf9141e8fce0d84156ee2">add_node</a>(<span class="stringliteral">&quot;rnode&quot;</span>, <a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(124));
<a name="l00077"></a>00077     r.<a class="code" href="classosm_1_1Relation.html#a3f8d6cec251d0b3ca3c8998e103e72a9">add_way</a>(<span class="stringliteral">&quot;rway&quot;</span>, <a class="code" href="classosm_1_1Way.html" title="Represents a way in OpenStreetMap (a sequence of Nodes)">osm::Way</a>(341));
<a name="l00078"></a>00078     r.<a class="code" href="classosm_1_1Relation.html#ac708492b4073ccdbedf0036f4d214770">add_rel</a>(<span class="stringliteral">&quot;rrel&quot;</span>, <a class="code" href="classosm_1_1Relation.html" title="Represents a relation in OpenStreetMap.">osm::Relation</a>(432));
<a name="l00079"></a>00079     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#a9ad89ebee202f58e1b5797b78412a346" title="Inserts relation into database.">insert_relation</a>(r);
<a name="l00080"></a>00080     std::vector&lt;std::tuple&lt;int64_t, double, double&gt; &gt; nodes {std::make_tuple(123, 2, 1), std::make_tuple(124, 2, 1)};
<a name="l00081"></a>00081     std::vector&lt;std::tuple&lt;int64_t&gt; &gt; ways {std::make_tuple(341)};
<a name="l00082"></a>00082     std::vector&lt;std::tuple&lt;int64_t, int64_t, int64_t&gt; &gt; edges {std::make_tuple(341, 123, 124)};
<a name="l00083"></a>00083     std::vector&lt;std::tuple&lt;int64_t, int64_t, int&gt; &gt; waynodes
<a name="l00084"></a>00084     {
<a name="l00085"></a>00085         std::make_tuple(341, 123, 0),
<a name="l00086"></a>00086         std::make_tuple(341, 124, 1)
<a name="l00087"></a>00087     };
<a name="l00088"></a>00088     std::sort(waynodes.begin(), waynodes.end());
<a name="l00089"></a>00089     std::vector&lt;std::tuple&lt;int64_t, std::string, std::string&gt; &gt; ndattrs {std::make_tuple(123, <span class="stringliteral">&quot;nkey&quot;</span>, <span class="stringliteral">&quot;nval&quot;</span>)};
<a name="l00090"></a>00090     std::vector&lt;std::tuple&lt;int64_t, std::string, std::string&gt; &gt; wattrs {std::make_tuple(341, <span class="stringliteral">&quot;wkey&quot;</span>, <span class="stringliteral">&quot;wval&quot;</span>)};
<a name="l00091"></a>00091     std::vector&lt;std::tuple&lt;int64_t&gt; &gt; rels {std::make_tuple(432), std::make_tuple(433)};
<a name="l00092"></a>00092     std::vector&lt;std::tuple&lt;int64_t, std::string, std::string&gt; &gt; rattrs {std::make_tuple(432, <span class="stringliteral">&quot;rkey&quot;</span>, <span class="stringliteral">&quot;rval&quot;</span>)};
<a name="l00093"></a>00093     std::vector&lt;std::tuple&lt;int64_t, std::string, int64_t&gt; &gt; nmembers {std::make_tuple(433, <span class="stringliteral">&quot;rnode&quot;</span>, 124)};
<a name="l00094"></a>00094     std::vector&lt;std::tuple&lt;int64_t, std::string, int64_t&gt; &gt; wmembers {std::make_tuple(433, <span class="stringliteral">&quot;rway&quot;</span>, 341)};
<a name="l00095"></a>00095     std::vector&lt;std::tuple&lt;int64_t, std::string, int64_t&gt; &gt; rmembers {std::make_tuple(433, <span class="stringliteral">&quot;rrel&quot;</span>, 432)};
<a name="l00096"></a>00096     <span class="keyword">auto</span> nodes2 = psql::query_sql&lt;int64_t, double, double&gt;(db.<a class="code" href="classosmdb_1_1OsmDatabase.html#abc4f484f44b51d8a0792be3834519cc3">get_db</a>(), <span class="stringliteral">&quot;SELECT ID, ST_X(Location::geometry), ST_Y(Location::geometry) FROM Nodes&quot;</span>);
<a name="l00097"></a>00097     <span class="keyword">auto</span> ways2 = psql::query_sql&lt;int64_t&gt;(db.<a class="code" href="classosmdb_1_1OsmDatabase.html#abc4f484f44b51d8a0792be3834519cc3">get_db</a>(), <span class="stringliteral">&quot;SELECT ID FROM Ways&quot;</span>);
<a name="l00098"></a>00098     <span class="keyword">auto</span> waynodes2 = psql::query_sql&lt;int64_t, int64_t, int&gt;(db.<a class="code" href="classosmdb_1_1OsmDatabase.html#abc4f484f44b51d8a0792be3834519cc3">get_db</a>(), <span class="stringliteral">&quot;SELECT WayID, NodeID, SequenceNo FROM WayNodes&quot;</span>);
<a name="l00099"></a>00099     <span class="keyword">auto</span> edges2 = psql::query_sql&lt;int64_t, int64_t, int64_t&gt;(db.<a class="code" href="classosmdb_1_1OsmDatabase.html#abc4f484f44b51d8a0792be3834519cc3">get_db</a>(), <span class="stringliteral">&quot;SELECT WayID, StartNodeID, EndNodeID FROM Edges&quot;</span>);
<a name="l00100"></a>00100     std::sort(waynodes2.begin(), waynodes2.end());
<a name="l00101"></a>00101     <span class="keyword">auto</span> ndattrs2 = psql::query_sql&lt;int64_t, std::string, std::string&gt;(db.<a class="code" href="classosmdb_1_1OsmDatabase.html#abc4f484f44b51d8a0792be3834519cc3">get_db</a>(), <span class="stringliteral">&quot;SELECT NodeID, Key, Value FROM NodeAttributes&quot;</span>);
<a name="l00102"></a>00102     <span class="keyword">auto</span> wattrs2 = psql::query_sql&lt;int64_t, std::string, std::string&gt;(db.<a class="code" href="classosmdb_1_1OsmDatabase.html#abc4f484f44b51d8a0792be3834519cc3">get_db</a>(), <span class="stringliteral">&quot;SELECT WayID, Key, Value FROM WayAttributes&quot;</span>);
<a name="l00103"></a>00103     <span class="keyword">auto</span> rels2 = psql::query_sql&lt;int64_t&gt; (db.<a class="code" href="classosmdb_1_1OsmDatabase.html#abc4f484f44b51d8a0792be3834519cc3">get_db</a>(), <span class="stringliteral">&quot;SELECT ID FROM Relations&quot;</span>);
<a name="l00104"></a>00104     <span class="keyword">auto</span> rattrs2 = psql::query_sql&lt;int64_t, std::string, std::string&gt;(db.<a class="code" href="classosmdb_1_1OsmDatabase.html#abc4f484f44b51d8a0792be3834519cc3">get_db</a>(), <span class="stringliteral">&quot;SELECT RelationID, Key, Value FROM RelationAttributes&quot;</span>);
<a name="l00105"></a>00105     <span class="keyword">auto</span> nmembers2 = psql::query_sql&lt;int64_t, std::string, int64_t&gt;(db.<a class="code" href="classosmdb_1_1OsmDatabase.html#abc4f484f44b51d8a0792be3834519cc3">get_db</a>(), <span class="stringliteral">&quot;SELECT RelationID, Role, NodeID FROM MemberNodes&quot;</span>);
<a name="l00106"></a>00106     <span class="keyword">auto</span> wmembers2 = psql::query_sql&lt;int64_t, std::string, int64_t&gt;(db.<a class="code" href="classosmdb_1_1OsmDatabase.html#abc4f484f44b51d8a0792be3834519cc3">get_db</a>(), <span class="stringliteral">&quot;SELECT RelationID, Role, WayID FROM MemberWays&quot;</span>);
<a name="l00107"></a>00107     <span class="keyword">auto</span> rmembers2 = psql::query_sql&lt;int64_t, std::string, int64_t&gt;(db.<a class="code" href="classosmdb_1_1OsmDatabase.html#abc4f484f44b51d8a0792be3834519cc3">get_db</a>(), <span class="stringliteral">&quot;SELECT ParentID, Role, ChildID FROM MemberRelations&quot;</span>);
<a name="l00108"></a>00108     BOOST_CHECK(nodes == nodes2);
<a name="l00109"></a>00109     BOOST_CHECK(ways == ways2);
<a name="l00110"></a>00110     BOOST_CHECK(edges == edges2);
<a name="l00111"></a>00111     BOOST_CHECK(waynodes == waynodes2);
<a name="l00112"></a>00112     BOOST_CHECK(ndattrs == ndattrs2);
<a name="l00113"></a>00113     BOOST_CHECK(wattrs == wattrs2);
<a name="l00114"></a>00114     BOOST_CHECK(rmembers == rmembers2);
<a name="l00115"></a>00115     BOOST_CHECK(wmembers == wmembers2);
<a name="l00116"></a>00116     BOOST_CHECK(nmembers == nmembers2);
<a name="l00117"></a>00117     BOOST_CHECK(rattrs == rattrs2);
<a name="l00118"></a>00118     BOOST_CHECK(rels == rels2);
<a name="l00119"></a>00119 
<a name="l00120"></a>00120 }
<a name="l00121"></a>00121 
<a name="l00122"></a><a class="code" href="osmdb_8cpp.html#af705f347e99f64afd72ed7a5faea2a35">00122</a> <a class="code" href="osmdb_8cpp.html#a504f79d7623f6b4064d243cc95297497">BOOST_AUTO_TEST_CASE</a>(new_import)
<a name="l00123"></a>00123 {
<a name="l00124"></a>00124 
<a name="l00125"></a>00125     <a class="code" href="classosmdb_1_1OsmDatabase.html" title="Class responsible for creating database schema.">osmdb::OsmDatabase</a> db(pdb);
<a name="l00126"></a>00126     db.<a class="code" href="classosmdb_1_1OsmDatabase.html#adc831649dec60db62f40da1c4e75f12b" title="Creates needed tables in the database.">create_tables</a>();
<a name="l00127"></a>00127     db.<a class="code" href="classosmdb_1_1OsmDatabase.html#aadc1ac7adc374532f0a66f6297e18e9e" title="Creates indexes and keys, this does not happen right away for optimization purposes.">create_indexes_and_keys</a>();
<a name="l00128"></a>00128     <a class="code" href="classosmdb_1_1ElementCopy.html" title="Handles copying into the Import table of the database.">osmdb::ElementCopy</a> ins(db);
<a name="l00129"></a>00129     ins.<a class="code" href="classosmdb_1_1ElementCopy.html#a2662e1ada6d310ec365b6acdeecd7ebb">start_copy</a>();
<a name="l00130"></a>00130     <a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a> n(123, 1, 2);
<a name="l00131"></a>00131     n.<a class="code" href="classosm_1_1Node.html#ae46c4674d161dab4d2c19fd667ebdd1f" title="Attributes of this Node.">tags</a>.insert(<a class="code" href="namespaceosm.html#ad6a83ea80b087de28d4bf3def9c2019a">osm::Tag</a>(<span class="stringliteral">&quot;nkey&quot;</span>, <span class="stringliteral">&quot;nval&quot;</span>));
<a name="l00132"></a>00132     ins.<a class="code" href="classosmdb_1_1ElementCopy.html#a4d7fac0b62180c3b5e82837ed857d97d">insert_node</a>(n);
<a name="l00133"></a>00133     n.<a class="code" href="classosm_1_1Node.html#ae46c4674d161dab4d2c19fd667ebdd1f" title="Attributes of this Node.">tags</a>.clear();
<a name="l00134"></a>00134     n.<a class="code" href="classosm_1_1Node.html#ad185c39bb708987f65fedac24d5ffc7e">id</a> = 124;
<a name="l00135"></a>00135     ins.<a class="code" href="classosmdb_1_1ElementCopy.html#a4d7fac0b62180c3b5e82837ed857d97d">insert_node</a>(n);
<a name="l00136"></a>00136     <a class="code" href="classosm_1_1Way.html" title="Represents a way in OpenStreetMap (a sequence of Nodes)">osm::Way</a> w(341);
<a name="l00137"></a>00137     w.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>.push_back(123);
<a name="l00138"></a>00138     w.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>.push_back(124);
<a name="l00139"></a>00139     w.<a class="code" href="classosm_1_1Way.html#a1fcc65bea2fe483ec5074d8527082853" title="Way attributes.">tags</a>.insert(<a class="code" href="namespaceosm.html#ad6a83ea80b087de28d4bf3def9c2019a">osm::Tag</a>(<span class="stringliteral">&quot;\r\n\twkey&quot;</span>, <span class="stringliteral">&quot;wval&quot;</span>));
<a name="l00140"></a>00140     ins.<a class="code" href="classosmdb_1_1ElementCopy.html#af518ec3e5ec98bc490b66b19ab315716">insert_way</a>(w);
<a name="l00141"></a>00141     <a class="code" href="classosm_1_1Relation.html" title="Represents a relation in OpenStreetMap.">osm::Relation</a> r(432);
<a name="l00142"></a>00142     r.<a class="code" href="classosm_1_1Relation.html#a8d5ece4430a4613c3088a39cb54b2e46" title="Attributes of this relation.">tags</a>.insert(<a class="code" href="namespaceosm.html#ad6a83ea80b087de28d4bf3def9c2019a">osm::Tag</a>(<span class="stringliteral">&quot;rkey&quot;</span>, <span class="stringliteral">&quot;rval&quot;</span>));
<a name="l00143"></a>00143     ins.<a class="code" href="classosmdb_1_1ElementCopy.html#a32f60870aafe2df2299543e0356185d1">insert_relation</a>(r);
<a name="l00144"></a>00144     r.<a class="code" href="classosm_1_1Relation.html#a8d5ece4430a4613c3088a39cb54b2e46" title="Attributes of this relation.">tags</a>.clear();
<a name="l00145"></a>00145     r.<a class="code" href="classosm_1_1Relation.html#a20b214bb2bfb793e75b1645cfc50d0c3">id</a> = 433;
<a name="l00146"></a>00146     r.<a class="code" href="classosm_1_1Relation.html#ab677d67ee44bf9141e8fce0d84156ee2">add_node</a>(<span class="stringliteral">&quot;rnode&quot;</span>, <a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(124));
<a name="l00147"></a>00147     r.<a class="code" href="classosm_1_1Relation.html#a3f8d6cec251d0b3ca3c8998e103e72a9">add_way</a>(<span class="stringliteral">&quot;rway&quot;</span>, <a class="code" href="classosm_1_1Way.html" title="Represents a way in OpenStreetMap (a sequence of Nodes)">osm::Way</a>(341));
<a name="l00148"></a>00148     r.<a class="code" href="classosm_1_1Relation.html#ac708492b4073ccdbedf0036f4d214770">add_rel</a>(<span class="stringliteral">&quot;rrel&quot;</span>, <a class="code" href="classosm_1_1Relation.html" title="Represents a relation in OpenStreetMap.">osm::Relation</a>(432));
<a name="l00149"></a>00149     ins.<a class="code" href="classosmdb_1_1ElementCopy.html#a32f60870aafe2df2299543e0356185d1">insert_relation</a>(r);
<a name="l00150"></a>00150     ins.<a class="code" href="classosmdb_1_1ElementCopy.html#a2ee70e4b5f579a2d3780c239fa0f28f4">end_copy</a>();
<a name="l00151"></a>00151     <a class="code" href="classosmdb_1_1ImportTableProcessor.html" title="Class responsible for moving of data from the Import table into appropriate tables in database...">osmdb::ImportTableProcessor</a> proc(db);
<a name="l00152"></a>00152     proc.<a class="code" href="classosmdb_1_1ImportTableProcessor.html#a90d27773870d4c39ab937201a057f974" title="Process the import table and perform all enabled actions.">process</a>();
<a name="l00153"></a>00153     std::vector&lt;std::tuple&lt;int64_t, double, double&gt; &gt; nodes {std::make_tuple(123, 2, 1), std::make_tuple(124, 2, 1)};
<a name="l00154"></a>00154     std::vector&lt;std::tuple&lt;int64_t&gt; &gt; ways {std::make_tuple(341)};
<a name="l00155"></a>00155     std::vector&lt;std::tuple&lt;int64_t, int64_t, int64_t&gt; &gt; edges {std::make_tuple(341, 123, 124)};
<a name="l00156"></a>00156     std::vector&lt;std::tuple&lt;int64_t, int64_t, int&gt; &gt; waynodes
<a name="l00157"></a>00157     {
<a name="l00158"></a>00158         std::make_tuple(341, 123, 0),
<a name="l00159"></a>00159         std::make_tuple(341, 124, 1)
<a name="l00160"></a>00160     };
<a name="l00161"></a>00161     std::sort(waynodes.begin(), waynodes.end());
<a name="l00162"></a>00162     std::vector&lt;std::tuple&lt;int64_t, std::string, std::string&gt; &gt; ndattrs {std::make_tuple(123, <span class="stringliteral">&quot;nkey&quot;</span>, <span class="stringliteral">&quot;nval&quot;</span>)};
<a name="l00163"></a>00163     std::vector&lt;std::tuple&lt;int64_t, std::string, std::string&gt; &gt; wattrs {std::make_tuple(341, <span class="stringliteral">&quot;\r\n\twkey&quot;</span>, <span class="stringliteral">&quot;wval&quot;</span>)};
<a name="l00164"></a>00164     std::vector&lt;std::tuple&lt;int64_t&gt; &gt; rels {std::make_tuple(432), std::make_tuple(433)};
<a name="l00165"></a>00165     std::vector&lt;std::tuple&lt;int64_t, std::string, std::string&gt; &gt; rattrs {std::make_tuple(432, <span class="stringliteral">&quot;rkey&quot;</span>, <span class="stringliteral">&quot;rval&quot;</span>)};
<a name="l00166"></a>00166     std::vector&lt;std::tuple&lt;int64_t, std::string, int64_t&gt; &gt; nmembers {std::make_tuple(433, <span class="stringliteral">&quot;rnode&quot;</span>, 124)};
<a name="l00167"></a>00167     std::vector&lt;std::tuple&lt;int64_t, std::string, int64_t&gt; &gt; wmembers {std::make_tuple(433, <span class="stringliteral">&quot;rway&quot;</span>, 341)};
<a name="l00168"></a>00168     std::vector&lt;std::tuple&lt;int64_t, std::string, int64_t&gt; &gt; rmembers {std::make_tuple(433, <span class="stringliteral">&quot;rrel&quot;</span>, 432)};
<a name="l00169"></a>00169     <span class="keyword">auto</span> nodes2 = psql::query_sql&lt;int64_t, double, double&gt;(db.<a class="code" href="classosmdb_1_1OsmDatabase.html#abc4f484f44b51d8a0792be3834519cc3">get_db</a>(), <span class="stringliteral">&quot;SELECT ID, ST_X(Location::geometry), ST_Y(Location::geometry) FROM Nodes&quot;</span>);
<a name="l00170"></a>00170     <span class="keyword">auto</span> ways2 = psql::query_sql&lt;int64_t&gt;(db.<a class="code" href="classosmdb_1_1OsmDatabase.html#abc4f484f44b51d8a0792be3834519cc3">get_db</a>(), <span class="stringliteral">&quot;SELECT ID FROM Ways&quot;</span>);
<a name="l00171"></a>00171     <span class="keyword">auto</span> waynodes2 = psql::query_sql&lt;int64_t, int64_t, int&gt;(db.<a class="code" href="classosmdb_1_1OsmDatabase.html#abc4f484f44b51d8a0792be3834519cc3">get_db</a>(), <span class="stringliteral">&quot;SELECT WayID, NodeID, SequenceNo FROM WayNodes&quot;</span>);
<a name="l00172"></a>00172     <span class="keyword">auto</span> edges2 = psql::query_sql&lt;int64_t, int64_t, int64_t&gt;(db.<a class="code" href="classosmdb_1_1OsmDatabase.html#abc4f484f44b51d8a0792be3834519cc3">get_db</a>(), <span class="stringliteral">&quot;SELECT WayID, StartNodeID, EndNodeID FROM Edges&quot;</span>);
<a name="l00173"></a>00173     std::sort(waynodes2.begin(), waynodes2.end());
<a name="l00174"></a>00174     <span class="keyword">auto</span> ndattrs2 = psql::query_sql&lt;int64_t, std::string, std::string&gt;(db.<a class="code" href="classosmdb_1_1OsmDatabase.html#abc4f484f44b51d8a0792be3834519cc3">get_db</a>(), <span class="stringliteral">&quot;SELECT NodeID, Key, Value FROM NodeAttributes&quot;</span>);
<a name="l00175"></a>00175     <span class="keyword">auto</span> wattrs2 = psql::query_sql&lt;int64_t, std::string, std::string&gt;(db.<a class="code" href="classosmdb_1_1OsmDatabase.html#abc4f484f44b51d8a0792be3834519cc3">get_db</a>(), <span class="stringliteral">&quot;SELECT WayID, Key, Value FROM WayAttributes&quot;</span>);
<a name="l00176"></a>00176     <span class="keyword">auto</span> rels2 = psql::query_sql&lt;int64_t&gt; (db.<a class="code" href="classosmdb_1_1OsmDatabase.html#abc4f484f44b51d8a0792be3834519cc3">get_db</a>(), <span class="stringliteral">&quot;SELECT ID FROM Relations&quot;</span>);
<a name="l00177"></a>00177     <span class="keyword">auto</span> rattrs2 = psql::query_sql&lt;int64_t, std::string, std::string&gt;(db.<a class="code" href="classosmdb_1_1OsmDatabase.html#abc4f484f44b51d8a0792be3834519cc3">get_db</a>(), <span class="stringliteral">&quot;SELECT RelationID, Key, Value FROM RelationAttributes&quot;</span>);
<a name="l00178"></a>00178     <span class="keyword">auto</span> nmembers2 = psql::query_sql&lt;int64_t, std::string, int64_t&gt;(db.<a class="code" href="classosmdb_1_1OsmDatabase.html#abc4f484f44b51d8a0792be3834519cc3">get_db</a>(), <span class="stringliteral">&quot;SELECT RelationID, Role, NodeID FROM MemberNodes&quot;</span>);
<a name="l00179"></a>00179     <span class="keyword">auto</span> wmembers2 = psql::query_sql&lt;int64_t, std::string, int64_t&gt;(db.<a class="code" href="classosmdb_1_1OsmDatabase.html#abc4f484f44b51d8a0792be3834519cc3">get_db</a>(), <span class="stringliteral">&quot;SELECT RelationID, Role, WayID FROM MemberWays&quot;</span>);
<a name="l00180"></a>00180     <span class="keyword">auto</span> rmembers2 = psql::query_sql&lt;int64_t, std::string, int64_t&gt;(db.<a class="code" href="classosmdb_1_1OsmDatabase.html#abc4f484f44b51d8a0792be3834519cc3">get_db</a>(), <span class="stringliteral">&quot;SELECT ParentID, Role, ChildID FROM MemberRelations&quot;</span>);
<a name="l00181"></a>00181     BOOST_CHECK(nodes == nodes2);
<a name="l00182"></a>00182     BOOST_CHECK(ways == ways2);
<a name="l00183"></a>00183     BOOST_CHECK(edges == edges2);
<a name="l00184"></a>00184     BOOST_CHECK(waynodes == waynodes2);
<a name="l00185"></a>00185     BOOST_CHECK(ndattrs == ndattrs2);
<a name="l00186"></a>00186     BOOST_CHECK(wattrs == wattrs2);
<a name="l00187"></a>00187     BOOST_CHECK(rmembers == rmembers2);
<a name="l00188"></a>00188     BOOST_CHECK(wmembers == wmembers2);
<a name="l00189"></a>00189     BOOST_CHECK(nmembers == nmembers2);
<a name="l00190"></a>00190     BOOST_CHECK(rattrs == rattrs2);
<a name="l00191"></a>00191     BOOST_CHECK(rels == rels2);
<a name="l00192"></a>00192 }
<a name="l00193"></a>00193 
<a name="l00194"></a><a class="code" href="osmdb_8cpp.html#ad111f595182a0ef6ad8fb89c34b85976">00194</a> <a class="code" href="osmdb_8cpp.html#a504f79d7623f6b4064d243cc95297497">BOOST_AUTO_TEST_CASE</a>(import_proc_dis)
<a name="l00195"></a>00195 {
<a name="l00196"></a>00196     <a class="code" href="classosmdb_1_1OsmDatabase.html" title="Class responsible for creating database schema.">osmdb::OsmDatabase</a> db(pdb);
<a name="l00197"></a>00197     <a class="code" href="classosmdb_1_1ImportTableProcessor.html" title="Class responsible for moving of data from the Import table into appropriate tables in database...">osmdb::ImportTableProcessor</a> proc(db);
<a name="l00198"></a>00198     proc.<a class="code" href="classosmdb_1_1ImportTableProcessor.html#a38526b91742b0763ed109672ca2d67d9" title="Disable all actions.">disable_all</a>();
<a name="l00199"></a>00199     proc.<a class="code" href="classosmdb_1_1ImportTableProcessor.html#a7d056c3db48680b7f1a82dcbe458e32c" title="Signal that fires after every action has happened.">action_signal</a>.connect(
<a name="l00200"></a>00200         [&amp;](<a class="code" href="namespaceosmdb.html#a1e497955ff9d8170cbc4c362c4e63c65" title="Actions which ImportTableProcessor can do.">osmdb::ImportTableAction</a>, int64_t)
<a name="l00201"></a>00201     {
<a name="l00202"></a>00202         BOOST_CHECK(<span class="keyword">false</span>);
<a name="l00203"></a>00203     });
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 }
<a name="l00206"></a>00206 
<a name="l00207"></a><a class="code" href="osmdb_8cpp.html#ac6826a73cd98bb3d6908ac747266b36b">00207</a> <a class="code" href="osmdb_8cpp.html#a504f79d7623f6b4064d243cc95297497">BOOST_AUTO_TEST_CASE</a>(empty_displaydb)
<a name="l00208"></a>00208 {
<a name="l00209"></a>00209     <a class="code" href="classosmdb_1_1OsmDatabase.html" title="Class responsible for creating database schema.">osmdb::OsmDatabase</a> odb(pdb);
<a name="l00210"></a>00210     odb.<a class="code" href="classosmdb_1_1OsmDatabase.html#adc831649dec60db62f40da1c4e75f12b" title="Creates needed tables in the database.">create_tables</a>();
<a name="l00211"></a>00211     odb.<a class="code" href="classosmdb_1_1OsmDatabase.html#aadc1ac7adc374532f0a66f6297e18e9e" title="Creates indexes and keys, this does not happen right away for optimization purposes.">create_indexes_and_keys</a>();
<a name="l00212"></a>00212     <a class="code" href="classosmdb_1_1DisplayDB.html" title="Class that allows for drawing of data from database.">osmdb::DisplayDB</a> db(odb, TEST_TO_SHOW_EDGES, 1, 1);
<a name="l00213"></a>00213     db.<a class="code" href="classosmdb_1_1DisplayDB.html#a28378184def6bceda242be22780ad9f0" title="Change current view to position bounded by topleft and bottomright using zoomlevel zoom...">set_bounds</a>(<a class="code" href="structgeo_1_1Point.html" title="Represents geospatial point with latitude and longitude specified in degrees.">geo::Point</a>(0, 0), <a class="code" href="structgeo_1_1Point.html" title="Represents geospatial point with latitude and longitude specified in degrees.">geo::Point</a>(1, 1), 1);
<a name="l00214"></a>00214 }
<a name="l00215"></a>00215 
<a name="l00216"></a><a class="code" href="osmdb_8cpp.html#a3caaf58b8738255bedfee47ae4c45792">00216</a> <a class="code" href="osmdb_8cpp.html#a504f79d7623f6b4064d243cc95297497">BOOST_AUTO_TEST_CASE</a>(simple)
<a name="l00217"></a>00217 {
<a name="l00218"></a>00218     <a class="code" href="classosmdb_1_1OsmDatabase.html" title="Class responsible for creating database schema.">osmdb::OsmDatabase</a> odb(pdb);
<a name="l00219"></a>00219     odb.<a class="code" href="classosmdb_1_1OsmDatabase.html#adc831649dec60db62f40da1c4e75f12b" title="Creates needed tables in the database.">create_tables</a>();
<a name="l00220"></a>00220     odb.<a class="code" href="classosmdb_1_1OsmDatabase.html#aadc1ac7adc374532f0a66f6297e18e9e" title="Creates indexes and keys, this does not happen right away for optimization purposes.">create_indexes_and_keys</a>();
<a name="l00221"></a>00221     <a class="code" href="classosmdb_1_1DisplayDB.html" title="Class that allows for drawing of data from database.">osmdb::DisplayDB</a> db(odb, TEST_TO_SHOW_EDGES, 1, 1);
<a name="l00222"></a>00222     <a class="code" href="classosmdb_1_1ElementInsertion.html" title="Responsible for inserting osm elements into database.">osmdb::ElementInsertion</a> ins(db.<a class="code" href="classosmdb_1_1DisplayDB.html#aff62840cc92eb4fdd1e8c0586197cd70">get_db</a>());
<a name="l00223"></a>00223     pdb.begin_transaction();
<a name="l00224"></a>00224     <a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a> nd(1, 0.5, 0.5);
<a name="l00225"></a>00225     nd.<a class="code" href="classosm_1_1Node.html#ae46c4674d161dab4d2c19fd667ebdd1f" title="Attributes of this Node.">tags</a>.insert(<a class="code" href="namespaceosm.html#ad6a83ea80b087de28d4bf3def9c2019a">osm::Tag</a>(<span class="stringliteral">&quot;key&quot;</span>, <span class="stringliteral">&quot;val&quot;</span>));
<a name="l00226"></a>00226     ins.insert_node(nd);
<a name="l00227"></a>00227     ins.insert_node(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(2, 0.4, 0.4));
<a name="l00228"></a>00228     ins.insert_node(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(3, 0.4, 0.8));
<a name="l00229"></a>00229     <a class="code" href="classosm_1_1Way.html" title="Represents a way in OpenStreetMap (a sequence of Nodes)">osm::Way</a> w(1);
<a name="l00230"></a>00230     w.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>.push_back(2);
<a name="l00231"></a>00231     w.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>.push_back(3);
<a name="l00232"></a>00232     w.<a class="code" href="classosm_1_1Way.html#a1fcc65bea2fe483ec5074d8527082853" title="Way attributes.">tags</a>.insert(<a class="code" href="namespaceosm.html#ad6a83ea80b087de28d4bf3def9c2019a">osm::Tag</a>(<span class="stringliteral">&quot;key&quot;</span>, <span class="stringliteral">&quot;val&quot;</span>));
<a name="l00233"></a>00233     ins.insert_way(w);
<a name="l00234"></a>00234     nd.<a class="code" href="classosm_1_1Node.html#ad185c39bb708987f65fedac24d5ffc7e">id</a> = 4;
<a name="l00235"></a>00235     nd.<a class="code" href="classosm_1_1Node.html#ad4c84f10229438b74baeaf28565243d1" title="Position of this Node.">position</a>.<a class="code" href="structgeo_1_1Point.html#acfc602d1a45e31a2a706ebb1409f00cf">lat</a> = 1.5;
<a name="l00236"></a>00236     nd.<a class="code" href="classosm_1_1Node.html#ad4c84f10229438b74baeaf28565243d1" title="Position of this Node.">position</a>.<a class="code" href="structgeo_1_1Point.html#a8e16143e46f186f2e8ffc580ef4b5023">lon</a> = 0.5;
<a name="l00237"></a>00237     ins.insert_node(nd);
<a name="l00238"></a>00238     ins.insert_node(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(5, 0.6, 0.4));
<a name="l00239"></a>00239     pdb.commit_transaction();
<a name="l00240"></a>00240     db.<a class="code" href="classosmdb_1_1DisplayDB.html#a28378184def6bceda242be22780ad9f0" title="Change current view to position bounded by topleft and bottomright using zoomlevel zoom...">set_bounds</a>(<a class="code" href="structgeo_1_1Point.html" title="Represents geospatial point with latitude and longitude specified in degrees.">geo::Point</a>(1, 0), <a class="code" href="structgeo_1_1Point.html" title="Represents geospatial point with latitude and longitude specified in degrees.">geo::Point</a>(0, 1), 1);
<a name="l00241"></a>00241     BOOST_CHECK(db.<a class="code" href="classosmdb_1_1DisplayDB.html#aaf7468b8980d4c18ebb8ee97f74b22d3">get_display_elements</a>().size() == 1);
<a name="l00242"></a>00242     <span class="keyword">auto</span> elems = db.<a class="code" href="classosmdb_1_1DisplayDB.html#abd78fae2df21a5bf16a1c5517e27c889" title="Retrieve osm::Elements in box specified by topleft and bottomright when current zoom level is zoom...">get_selected</a>(<a class="code" href="structgeo_1_1Point.html" title="Represents geospatial point with latitude and longitude specified in degrees.">geo::Point</a>(1, 0), <a class="code" href="structgeo_1_1Point.html" title="Represents geospatial point with latitude and longitude specified in degrees.">geo::Point</a>(0, 1), 1);
<a name="l00243"></a>00243     BOOST_CHECK(elems.size() == 1);
<a name="l00244"></a>00244     BOOST_CHECK(elems[0]-&gt;get_description().front().first == <span class="stringliteral">&quot;way&quot;</span>);
<a name="l00245"></a>00245 }
<a name="l00246"></a>00246 
<a name="l00247"></a><a class="code" href="osmdb_8cpp.html#ad935e165e26e578c3907c11eb6a8a798">00247</a> <a class="code" href="osmdb_8cpp.html#a504f79d7623f6b4064d243cc95297497">BOOST_AUTO_TEST_CASE</a>(wayred_cursor)
<a name="l00248"></a>00248 {
<a name="l00249"></a>00249     <a class="code" href="classosmdb_1_1OsmDatabase.html" title="Class responsible for creating database schema.">osmdb::OsmDatabase</a> odb(pdb);
<a name="l00250"></a>00250     odb.<a class="code" href="classosmdb_1_1OsmDatabase.html#adc831649dec60db62f40da1c4e75f12b" title="Creates needed tables in the database.">create_tables</a>();
<a name="l00251"></a>00251     odb.<a class="code" href="classosmdb_1_1OsmDatabase.html#aadc1ac7adc374532f0a66f6297e18e9e" title="Creates indexes and keys, this does not happen right away for optimization purposes.">create_indexes_and_keys</a>();
<a name="l00252"></a>00252     <a class="code" href="classosmdb_1_1ElementInsertion.html" title="Responsible for inserting osm elements into database.">osmdb::ElementInsertion</a> ins(odb);
<a name="l00253"></a>00253     pdb.begin_transaction();
<a name="l00254"></a>00254     <a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a> nd(1, 0.5, 0.5);
<a name="l00255"></a>00255     nd.<a class="code" href="classosm_1_1Node.html#ae46c4674d161dab4d2c19fd667ebdd1f" title="Attributes of this Node.">tags</a>.insert(<a class="code" href="namespaceosm.html#ad6a83ea80b087de28d4bf3def9c2019a">osm::Tag</a>(<span class="stringliteral">&quot;key&quot;</span>, <span class="stringliteral">&quot;val&quot;</span>));
<a name="l00256"></a>00256     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#a936b84b041dd4035a4601fa0e150f2c2" title="Inserts node into database.">insert_node</a>(nd);
<a name="l00257"></a>00257     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#a936b84b041dd4035a4601fa0e150f2c2" title="Inserts node into database.">insert_node</a>(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(2, 0.4, 0.4));
<a name="l00258"></a>00258     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#a936b84b041dd4035a4601fa0e150f2c2" title="Inserts node into database.">insert_node</a>(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(3, 0.4, 0.8));
<a name="l00259"></a>00259     <a class="code" href="classosm_1_1Way.html" title="Represents a way in OpenStreetMap (a sequence of Nodes)">osm::Way</a> w(1);
<a name="l00260"></a>00260     w.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>.push_back(2);
<a name="l00261"></a>00261     w.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>.push_back(3);
<a name="l00262"></a>00262     w.<a class="code" href="classosm_1_1Way.html#a1fcc65bea2fe483ec5074d8527082853" title="Way attributes.">tags</a>.insert(<a class="code" href="namespaceosm.html#ad6a83ea80b087de28d4bf3def9c2019a">osm::Tag</a>(<span class="stringliteral">&quot;key&quot;</span>, <span class="stringliteral">&quot;val&quot;</span>));
<a name="l00263"></a>00263     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#afbd9085b11e0fedfee39799ab12801ba" title="Inserts way into database.">insert_way</a>(w);
<a name="l00264"></a>00264     w = <a class="code" href="namespaceosm.html#a43a9306ba3e7fd761cbd843f3e3f0faaa4f2fbafd67e914b85a5de4f2087e0794">osm::Way</a>(2);
<a name="l00265"></a>00265     nd.<a class="code" href="classosm_1_1Node.html#ad185c39bb708987f65fedac24d5ffc7e">id</a> = 4;
<a name="l00266"></a>00266     nd.<a class="code" href="classosm_1_1Node.html#ad4c84f10229438b74baeaf28565243d1" title="Position of this Node.">position</a>.<a class="code" href="structgeo_1_1Point.html#acfc602d1a45e31a2a706ebb1409f00cf">lat</a> = 1.5;
<a name="l00267"></a>00267     nd.<a class="code" href="classosm_1_1Node.html#ad4c84f10229438b74baeaf28565243d1" title="Position of this Node.">position</a>.<a class="code" href="structgeo_1_1Point.html#a8e16143e46f186f2e8ffc580ef4b5023">lon</a> = 0.5;
<a name="l00268"></a>00268     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#a936b84b041dd4035a4601fa0e150f2c2" title="Inserts node into database.">insert_node</a>(nd);
<a name="l00269"></a>00269     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#a936b84b041dd4035a4601fa0e150f2c2" title="Inserts node into database.">insert_node</a>(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(5, 0.6, 0.4));
<a name="l00270"></a>00270     pdb.commit_transaction();
<a name="l00271"></a>00271     boost::property_tree::ptree entries;
<a name="l00272"></a>00272     boost::property_tree::ptree kv;
<a name="l00273"></a>00273     kv.put(<span class="stringliteral">&quot;key&quot;</span>, <span class="stringliteral">&quot;key&quot;</span>);
<a name="l00274"></a>00274     kv.put(<span class="stringliteral">&quot;value&quot;</span>, <span class="stringliteral">&quot;val&quot;</span>);
<a name="l00275"></a>00275     entries.put_child(<span class="stringliteral">&quot;entries.entry.elements.el&quot;</span>, kv);
<a name="l00276"></a>00276     <span class="keyword">auto</span> st(<a class="code" href="namespacesqllib.html#af0a8e2826a0336797a6a921c265334c0">sqllib::get_decl_wayred_crs</a>(entries, pdb));
<a name="l00277"></a>00277     <span class="keyword">auto</span> crs(<a class="code" href="namespacepsql.html#a409c42714c3910af8285b62a5811ff72" title="Crates a cursor from a statement.">psql::make_cursor</a>(pdb, <span class="stringliteral">&quot;wayred_crs&quot;</span>, st));
<a name="l00278"></a>00278     pdb.begin_transaction();
<a name="l00279"></a>00279     crs.open();
<a name="l00280"></a>00280     crs.fetch(10);
<a name="l00281"></a>00281     <span class="keyword">auto</span> vect(crs.get_buffer());
<a name="l00282"></a>00282     BOOST_CHECK(vect.size() == 2);
<a name="l00283"></a>00283     crs.close();
<a name="l00284"></a>00284     pdb.rollback_transaction();
<a name="l00285"></a>00285 }
<a name="l00286"></a>00286 
<a name="l00287"></a><a class="code" href="osmdb_8cpp.html#a6f86155b8a2a9b75d9c102bdcb8cf18d">00287</a> <a class="code" href="osmdb_8cpp.html#a504f79d7623f6b4064d243cc95297497">BOOST_AUTO_TEST_CASE</a>(properties)
<a name="l00288"></a>00288 {
<a name="l00289"></a>00289     <a class="code" href="classosmdb_1_1OsmDatabase.html" title="Class responsible for creating database schema.">osmdb::OsmDatabase</a> odb(pdb);
<a name="l00290"></a>00290     odb.<a class="code" href="classosmdb_1_1OsmDatabase.html#adc831649dec60db62f40da1c4e75f12b" title="Creates needed tables in the database.">create_tables</a>();
<a name="l00291"></a>00291     <a class="code" href="classosmdb_1_1ElementInsertion.html" title="Responsible for inserting osm elements into database.">osmdb::ElementInsertion</a> ins(odb);
<a name="l00292"></a>00292     <a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a> n(123, 1, 2);
<a name="l00293"></a>00293     n.<a class="code" href="classosm_1_1Node.html#ae46c4674d161dab4d2c19fd667ebdd1f" title="Attributes of this Node.">tags</a>.insert(<a class="code" href="namespaceosm.html#ad6a83ea80b087de28d4bf3def9c2019a">osm::Tag</a>(<span class="stringliteral">&quot;nkey&quot;</span>, <span class="stringliteral">&quot;nval&quot;</span>));
<a name="l00294"></a>00294     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#a936b84b041dd4035a4601fa0e150f2c2" title="Inserts node into database.">insert_node</a>(n);
<a name="l00295"></a>00295     n.<a class="code" href="classosm_1_1Node.html#ae46c4674d161dab4d2c19fd667ebdd1f" title="Attributes of this Node.">tags</a>.clear();
<a name="l00296"></a>00296     n.<a class="code" href="classosm_1_1Node.html#ad185c39bb708987f65fedac24d5ffc7e">id</a> = 124;
<a name="l00297"></a>00297     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#a936b84b041dd4035a4601fa0e150f2c2" title="Inserts node into database.">insert_node</a>(n);
<a name="l00298"></a>00298     <a class="code" href="classosm_1_1Way.html" title="Represents a way in OpenStreetMap (a sequence of Nodes)">osm::Way</a> w(341);
<a name="l00299"></a>00299     w.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>.push_back(123);
<a name="l00300"></a>00300     w.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>.push_back(124);
<a name="l00301"></a>00301     w.<a class="code" href="classosm_1_1Way.html#a1fcc65bea2fe483ec5074d8527082853" title="Way attributes.">tags</a>.insert(<a class="code" href="namespaceosm.html#ad6a83ea80b087de28d4bf3def9c2019a">osm::Tag</a>(<span class="stringliteral">&quot;wkey&quot;</span>, <span class="stringliteral">&quot;wval&quot;</span>));
<a name="l00302"></a>00302     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#afbd9085b11e0fedfee39799ab12801ba" title="Inserts way into database.">insert_way</a>(w);
<a name="l00303"></a>00303     <a class="code" href="classosm_1_1Relation.html" title="Represents a relation in OpenStreetMap.">osm::Relation</a> r(432);
<a name="l00304"></a>00304     r.<a class="code" href="classosm_1_1Relation.html#a8d5ece4430a4613c3088a39cb54b2e46" title="Attributes of this relation.">tags</a>.insert(<a class="code" href="namespaceosm.html#ad6a83ea80b087de28d4bf3def9c2019a">osm::Tag</a>(<span class="stringliteral">&quot;rkey&quot;</span>, <span class="stringliteral">&quot;rval&quot;</span>));
<a name="l00305"></a>00305     r.<a class="code" href="classosm_1_1Relation.html#ab677d67ee44bf9141e8fce0d84156ee2">add_node</a>(<span class="stringliteral">&quot;rnode&quot;</span>, <a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(124));
<a name="l00306"></a>00306     r.<a class="code" href="classosm_1_1Relation.html#a3f8d6cec251d0b3ca3c8998e103e72a9">add_way</a>(<span class="stringliteral">&quot;rway&quot;</span>, <a class="code" href="classosm_1_1Way.html" title="Represents a way in OpenStreetMap (a sequence of Nodes)">osm::Way</a>(341));
<a name="l00307"></a>00307     r.<a class="code" href="classosm_1_1Relation.html#ac708492b4073ccdbedf0036f4d214770">add_rel</a>(<span class="stringliteral">&quot;rrel&quot;</span>, <a class="code" href="classosm_1_1Relation.html" title="Represents a relation in OpenStreetMap.">osm::Relation</a>(433));
<a name="l00308"></a>00308     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#a9ad89ebee202f58e1b5797b78412a346" title="Inserts relation into database.">insert_relation</a>(r);
<a name="l00309"></a>00309     <a class="code" href="classosmdb_1_1PropertiesSelection.html" title="Class used by osm elements to fill their internal information.">osmdb::PropertiesSelection</a> db(odb);
<a name="l00310"></a>00310     BOOST_CHECK(db.<a class="code" href="classosmdb_1_1PropertiesSelection.html#a640cf4050e9c66ecca8077288955d468">get_node_tags</a>(123).count(<a class="code" href="namespaceosm.html#ad6a83ea80b087de28d4bf3def9c2019a">osm::Tag</a>(<span class="stringliteral">&quot;nkey&quot;</span>, <span class="stringliteral">&quot;nval&quot;</span>)) == 1);
<a name="l00311"></a>00311     <a class="code" href="structgeo_1_1Point.html" title="Represents geospatial point with latitude and longitude specified in degrees.">geo::Point</a> p(1, 2);
<a name="l00312"></a>00312     BOOST_CHECK(db.<a class="code" href="classosmdb_1_1PropertiesSelection.html#aed9439183b73791bc87dca0665c2a04b">get_position</a>(123).<a class="code" href="structgeo_1_1Point.html#a16742b9df1707a93c85bd445991472ad">close</a>(p, 0.0001));
<a name="l00313"></a>00313     BOOST_CHECK(db.<a class="code" href="classosmdb_1_1PropertiesSelection.html#a7ce30e492f4104cc83381c6fedee2c0a">get_way_tags</a>(341).count(<a class="code" href="namespaceosm.html#ad6a83ea80b087de28d4bf3def9c2019a">osm::Tag</a>(<span class="stringliteral">&quot;wkey&quot;</span>, <span class="stringliteral">&quot;wval&quot;</span>)) == 1);
<a name="l00314"></a>00314     BOOST_CHECK(db.<a class="code" href="classosmdb_1_1PropertiesSelection.html#acf82f15a3fc738a1db5339314481885e">get_waynodes</a>(341).size() == 2);
<a name="l00315"></a>00315     BOOST_CHECK(db.<a class="code" href="classosmdb_1_1PropertiesSelection.html#acf82f15a3fc738a1db5339314481885e">get_waynodes</a>(341)[0] == 123);
<a name="l00316"></a>00316     BOOST_CHECK(db.<a class="code" href="classosmdb_1_1PropertiesSelection.html#abaf6e6203a20b969fb346e662b5f0ab3">get_relation_tags</a>(432).count(<a class="code" href="namespaceosm.html#ad6a83ea80b087de28d4bf3def9c2019a">osm::Tag</a>(<span class="stringliteral">&quot;rkey&quot;</span>, <span class="stringliteral">&quot;rval&quot;</span>)) == 1);
<a name="l00317"></a>00317     BOOST_CHECK(db.<a class="code" href="classosmdb_1_1PropertiesSelection.html#a4c7560ff80721e7acdeabb728726953d">get_node_members</a>(432).count(<span class="stringliteral">&quot;rnode&quot;</span>) == 1);
<a name="l00318"></a>00318     BOOST_CHECK(db.<a class="code" href="classosmdb_1_1PropertiesSelection.html#a72b02d23d3e15ea1f40097959b8c8a16">get_way_members</a>(432).count(<span class="stringliteral">&quot;rway&quot;</span>) == 1);
<a name="l00319"></a>00319     BOOST_CHECK(db.<a class="code" href="classosmdb_1_1PropertiesSelection.html#ad8d97c2121736c26294a4cf75982353a">get_relation_members</a>(432).count(<span class="stringliteral">&quot;rrel&quot;</span>) == 1);
<a name="l00320"></a>00320     <a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a> n2(123);
<a name="l00321"></a>00321     n2.fill(db);
<a name="l00322"></a>00322     n.<a class="code" href="classosm_1_1Node.html#ad185c39bb708987f65fedac24d5ffc7e">id</a> = 123;
<a name="l00323"></a>00323     n.<a class="code" href="classosm_1_1Node.html#ae46c4674d161dab4d2c19fd667ebdd1f" title="Attributes of this Node.">tags</a>.insert(<a class="code" href="namespaceosm.html#ad6a83ea80b087de28d4bf3def9c2019a">osm::Tag</a>(<span class="stringliteral">&quot;nkey&quot;</span>, <span class="stringliteral">&quot;nval&quot;</span>));
<a name="l00324"></a>00324     BOOST_CHECK(n == n2);
<a name="l00325"></a>00325     <a class="code" href="classosm_1_1Way.html" title="Represents a way in OpenStreetMap (a sequence of Nodes)">osm::Way</a> w2(341);
<a name="l00326"></a>00326     w2.<a class="code" href="classosm_1_1Way.html#a58e62125d0aa5c3e4ff0e93170a393b9" title="Fill attributes and possibly other information from db.">fill</a>(db);
<a name="l00327"></a>00327     w.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>[0].fill(db);
<a name="l00328"></a>00328     w.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>[1].fill(db);
<a name="l00329"></a>00329     BOOST_CHECK(w == w2);
<a name="l00330"></a>00330     <a class="code" href="classosm_1_1Relation.html" title="Represents a relation in OpenStreetMap.">osm::Relation</a> r2(432);
<a name="l00331"></a>00331     r2.<a class="code" href="classosm_1_1Relation.html#a55a0cd012405bd96025576618f8d3beb" title="Fill attributes and possibly other information from db.">fill</a>(db);
<a name="l00332"></a>00332     <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = r.<a class="code" href="classosm_1_1Relation.html#a5bc02e7b250f8b99efb3e32c2f7056f5" title="Member elements of this relation.">members</a>.begin(); it != r.<a class="code" href="classosm_1_1Relation.html#a5bc02e7b250f8b99efb3e32c2f7056f5" title="Member elements of this relation.">members</a>.end(); ++it)
<a name="l00333"></a>00333         it-&gt;second-&gt;fill(db);
<a name="l00334"></a>00334     BOOST_CHECK(r == r2);
<a name="l00335"></a>00335 }
<a name="l00336"></a>00336 
<a name="l00337"></a><a class="code" href="osmdb_8cpp.html#a36b0bf4a7557720c1cb88c5077a29907">00337</a> <a class="code" href="osmdb_8cpp.html#a504f79d7623f6b4064d243cc95297497">BOOST_AUTO_TEST_CASE</a>(waylister)
<a name="l00338"></a>00338 {
<a name="l00339"></a>00339     <a class="code" href="classosmdb_1_1OsmDatabase.html" title="Class responsible for creating database schema.">osmdb::OsmDatabase</a> odb(pdb);
<a name="l00340"></a>00340     odb.<a class="code" href="classosmdb_1_1OsmDatabase.html#adc831649dec60db62f40da1c4e75f12b" title="Creates needed tables in the database.">create_tables</a>();
<a name="l00341"></a>00341     odb.<a class="code" href="classosmdb_1_1OsmDatabase.html#aadc1ac7adc374532f0a66f6297e18e9e" title="Creates indexes and keys, this does not happen right away for optimization purposes.">create_indexes_and_keys</a>();
<a name="l00342"></a>00342     <a class="code" href="classosmdb_1_1ElementInsertion.html" title="Responsible for inserting osm elements into database.">osmdb::ElementInsertion</a> ins(odb);
<a name="l00343"></a>00343     pdb.begin_transaction();
<a name="l00344"></a>00344     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#a936b84b041dd4035a4601fa0e150f2c2" title="Inserts node into database.">insert_node</a>(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(2, 0.4, 0.4));
<a name="l00345"></a>00345     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#a936b84b041dd4035a4601fa0e150f2c2" title="Inserts node into database.">insert_node</a>(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(3, 0.4, 0.8));
<a name="l00346"></a>00346     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#a936b84b041dd4035a4601fa0e150f2c2" title="Inserts node into database.">insert_node</a>(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(4, 0.4, 0.8));
<a name="l00347"></a>00347     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#a936b84b041dd4035a4601fa0e150f2c2" title="Inserts node into database.">insert_node</a>(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(5, 0.4, 0.8));
<a name="l00348"></a>00348     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#a936b84b041dd4035a4601fa0e150f2c2" title="Inserts node into database.">insert_node</a>(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(6, 0.4, 0.8));
<a name="l00349"></a>00349     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#a936b84b041dd4035a4601fa0e150f2c2" title="Inserts node into database.">insert_node</a>(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(7, 0.4, 0.8));
<a name="l00350"></a>00350     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#a936b84b041dd4035a4601fa0e150f2c2" title="Inserts node into database.">insert_node</a>(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(8, 0.4, 0.8));
<a name="l00351"></a>00351     <a class="code" href="classosm_1_1Way.html" title="Represents a way in OpenStreetMap (a sequence of Nodes)">osm::Way</a> w(1);
<a name="l00352"></a>00352     w.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>.push_back(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(2, 0.4, 0.4));
<a name="l00353"></a>00353     w.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>.push_back(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(3, 0.4, 0.8));
<a name="l00354"></a>00354     w.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>.push_back(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(4, 0.4, 0.8));
<a name="l00355"></a>00355     w.<a class="code" href="classosm_1_1Way.html#a1fcc65bea2fe483ec5074d8527082853" title="Way attributes.">tags</a>.insert(<a class="code" href="namespaceosm.html#ad6a83ea80b087de28d4bf3def9c2019a">osm::Tag</a>(<span class="stringliteral">&quot;key&quot;</span>, <span class="stringliteral">&quot;val&quot;</span>));
<a name="l00356"></a>00356     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#afbd9085b11e0fedfee39799ab12801ba" title="Inserts way into database.">insert_way</a>(w);
<a name="l00357"></a>00357     <a class="code" href="classosm_1_1Way.html" title="Represents a way in OpenStreetMap (a sequence of Nodes)">osm::Way</a> w2(2);
<a name="l00358"></a>00358     w2.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>.push_back(3);
<a name="l00359"></a>00359     w2.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>.push_back(5);
<a name="l00360"></a>00360     w2.<a class="code" href="classosm_1_1Way.html#a1fcc65bea2fe483ec5074d8527082853" title="Way attributes.">tags</a>.insert(<a class="code" href="namespaceosm.html#ad6a83ea80b087de28d4bf3def9c2019a">osm::Tag</a>(<span class="stringliteral">&quot;asdf&quot;</span>, <span class="stringliteral">&quot;bsdf&quot;</span>));
<a name="l00361"></a>00361     w2.<a class="code" href="classosm_1_1Way.html#a1fcc65bea2fe483ec5074d8527082853" title="Way attributes.">tags</a>.insert(<a class="code" href="namespaceosm.html#ad6a83ea80b087de28d4bf3def9c2019a">osm::Tag</a>(<span class="stringliteral">&quot;fcda&quot;</span>, <span class="stringliteral">&quot;gas&quot;</span>));
<a name="l00362"></a>00362     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#afbd9085b11e0fedfee39799ab12801ba" title="Inserts way into database.">insert_way</a>(w2);
<a name="l00363"></a>00363     <a class="code" href="classosm_1_1Way.html" title="Represents a way in OpenStreetMap (a sequence of Nodes)">osm::Way</a> w3(3);
<a name="l00364"></a>00364     w3.<a class="code" href="classosm_1_1Way.html#a1fcc65bea2fe483ec5074d8527082853" title="Way attributes.">tags</a>.insert(<a class="code" href="namespaceosm.html#ad6a83ea80b087de28d4bf3def9c2019a">osm::Tag</a>(<span class="stringliteral">&quot;key&quot;</span>, <span class="stringliteral">&quot;val&quot;</span>));
<a name="l00365"></a>00365     w3.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>.push_back(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(4, 0.4, 0.8));
<a name="l00366"></a>00366     w3.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>.push_back(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(5, 0.4, 0.8));
<a name="l00367"></a>00367     w3.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>.push_back(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(6, 0.4, 0.8));
<a name="l00368"></a>00368     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#afbd9085b11e0fedfee39799ab12801ba" title="Inserts way into database.">insert_way</a>(w3);
<a name="l00369"></a>00369     <a class="code" href="classosm_1_1Way.html" title="Represents a way in OpenStreetMap (a sequence of Nodes)">osm::Way</a> w4(4);
<a name="l00370"></a>00370     w4.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>.push_back(5);
<a name="l00371"></a>00371     w4.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>.push_back(7);
<a name="l00372"></a>00372     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#afbd9085b11e0fedfee39799ab12801ba" title="Inserts way into database.">insert_way</a>(w4);
<a name="l00373"></a>00373     <a class="code" href="classosm_1_1Way.html" title="Represents a way in OpenStreetMap (a sequence of Nodes)">osm::Way</a> w5(5);
<a name="l00374"></a>00374     w5.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>.push_back(6);
<a name="l00375"></a>00375     w5.<a class="code" href="classosm_1_1Way.html#a83d17999c96d93213c3dc4d33ba203e7" title="Member nodes - from first to last.">nodes</a>.push_back(8);
<a name="l00376"></a>00376     ins.<a class="code" href="classosmdb_1_1ElementInsertion.html#afbd9085b11e0fedfee39799ab12801ba" title="Inserts way into database.">insert_way</a>(w5);
<a name="l00377"></a>00377     std::map&lt;osm::Way, std::multimap&lt;osm::Node, osm::Way, osm::LtByID&gt;, <a class="code" href="classosm_1_1LtByID.html">osm::LtByID</a>&gt; exp;
<a name="l00378"></a>00378     std::multimap&lt;osm::Node, osm::Way, osm::LtByID&gt; mp;
<a name="l00379"></a>00379     mp.insert(std::make_pair(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(3, 0.4, 0.8), w2));
<a name="l00380"></a>00380     mp.insert(std::make_pair(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(4, 0.4, 0.8), w3));
<a name="l00381"></a>00381     exp[w] = mp;
<a name="l00382"></a>00382     mp.clear();
<a name="l00383"></a>00383     mp.insert(std::make_pair(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(4, 0.4, 0.8), w));
<a name="l00384"></a>00384     mp.insert(std::make_pair(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(5, 0.4, 0.8), w4));
<a name="l00385"></a>00385     mp.insert(std::make_pair(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(5, 0.4, 0.8), w2));
<a name="l00386"></a>00386     mp.insert(std::make_pair(<a class="code" href="classosm_1_1Node.html" title="Represents Node in OpenStreetMap (a point on map)">osm::Node</a>(6, 0.4, 0.8), w5));
<a name="l00387"></a>00387     exp[w3] = mp;
<a name="l00388"></a>00388     pdb.commit_transaction();
<a name="l00389"></a>00389     pdb.begin_transaction();
<a name="l00390"></a>00390     std::map&lt;osm::Way, std::multimap&lt;osm::Node, osm::Way, osm::LtByID&gt;, <a class="code" href="classosm_1_1LtByID.html">osm::LtByID</a>&gt; got;
<a name="l00391"></a>00391     <a class="code" href="classosmdb_1_1WayLister.html" title="Responsible for retrieving ways for the purpose of filtering member nodes.">osmdb::WayLister</a> wl(odb, std::multimap&lt;std::string, std::string&gt; {std::make_pair(<span class="stringliteral">&quot;key&quot;</span>, <span class="stringliteral">&quot;val&quot;</span>)}, 2);
<a name="l00392"></a>00392     <span class="keywordflow">while</span> (!wl.end())
<a name="l00393"></a>00393     {
<a name="l00394"></a>00394         wl.<a class="code" href="classosmdb_1_1WayLister.html#a174e51f0ba57453f9cf1d6525727c6e9" title="Fetch next chunk of data from database.">next</a>();
<a name="l00395"></a>00395         <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = wl.get_current_connected_ways().begin(); it != wl.get_current_connected_ways().end(); ++it)
<a name="l00396"></a>00396         {
<a name="l00397"></a>00397             got.insert(*it);
<a name="l00398"></a>00398         }
<a name="l00399"></a>00399     }
<a name="l00400"></a>00400     pdb.commit_transaction();
<a name="l00401"></a>00401     <span class="keyword">class </span>WayCmpIgnNd
<a name="l00402"></a>00402     {
<a name="l00403"></a>00403     <span class="keyword">public</span>:
<a name="l00404"></a>00404         <span class="keywordtype">bool</span> operator()(<a class="code" href="classosm_1_1Way.html" title="Represents a way in OpenStreetMap (a sequence of Nodes)">osm::Way</a> <span class="keyword">const</span>&amp; w1, <a class="code" href="classosm_1_1Way.html" title="Represents a way in OpenStreetMap (a sequence of Nodes)">osm::Way</a> <span class="keyword">const</span>&amp; w2)
<a name="l00405"></a>00405         {
<a name="l00406"></a>00406             <span class="keywordflow">return</span> w1.<a class="code" href="classosm_1_1Way.html#a12bfbeaef3749964a1dea1ba90fe9ef1">id</a> == w2.<a class="code" href="classosm_1_1Way.html#a12bfbeaef3749964a1dea1ba90fe9ef1">id</a> &amp;&amp; w1.<a class="code" href="classosm_1_1Way.html#a1fcc65bea2fe483ec5074d8527082853" title="Way attributes.">tags</a> == w2.<a class="code" href="classosm_1_1Way.html#a1fcc65bea2fe483ec5074d8527082853" title="Way attributes.">tags</a>;
<a name="l00407"></a>00407         }
<a name="l00408"></a>00408     };
<a name="l00409"></a>00409     <span class="keyword">class </span>Comp
<a name="l00410"></a>00410     {
<a name="l00411"></a>00411     <span class="keyword">public</span>:
<a name="l00412"></a>00412         <span class="keywordtype">bool</span> operator()(decltype(*got.begin()) p1, decltype(*got.begin()) p2)
<a name="l00413"></a>00413         {
<a name="l00414"></a>00414             <span class="keywordflow">return</span> <a class="code" href="classosm_1_1EqByID.html">osm::EqByID</a>()(p1.first, p2.first) &amp;&amp; util::multimap_eq&lt;WayCmpIgnNd&gt;(p1.second, p2.second);
<a name="l00415"></a>00415         }
<a name="l00416"></a>00416     } cmp;
<a name="l00417"></a>00417     <span class="keywordtype">bool</span> b = std::equal(got.begin(), got.end(), exp.begin(), cmp);
<a name="l00418"></a>00418     BOOST_CHECK(b);
<a name="l00419"></a>00419 }
<a name="l00420"></a>00420 
<a name="l00421"></a>00421 BOOST_AUTO_TEST_SUITE_END()
</pre></div></div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Mon Jan 23 2012 01:48:50 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
